<ion-content [scrollY]="false">
  <div class="page-top">
    <div class="top-row">
      <h1 class="page-title">Mapa</h1>
      <div class="top-actions">
        <ion-button fill="clear" size="small" (click)="fitAllStores()">
          <ion-icon name="expand-outline" slot="icon-only"></ion-icon>
        </ion-button>
        <ion-button fill="clear" size="small" (click)="centerOnUser()">
          <ion-icon name="locate-outline" slot="icon-only"></ion-icon>
        </ion-button>
      </div>
    </div>

    <!-- Filter chips -->
    <div class="filter-row">
      <button
        class="filter-chip"
        *ngFor="let filter of storeFilters"
        [class.active]="filter.active"
        (click)="toggleFilter(filter)"
      >
        <ion-icon [name]="filter.icon"></ion-icon>
        {{ filter.label }}
      </button>
    </div>
  </div>

  <!-- Map -->
  <div class="map-container" id="preci-map"></div>

  <!-- Location error banner -->
  <div class="location-error" *ngIf="locationError">
    <ion-icon name="warning-outline"></ion-icon>
    <span>{{ locationError }}</span>
  </div>

  <!-- Store count badge -->
  <div class="store-count" *ngIf="stores.length > 0" [class.shifted]="locationError">
    {{ stores.length }} tiendas
  </div>

  <!-- Bottom store list (draggable sheet style) -->
  <div class="store-sheet">
    <div class="sheet-handle"></div>
    <div class="sheet-header">
      <span class="preci-section-label">Cerca de ti</span>
      <button class="add-store-btn" (click)="openSuggestStore()" aria-label="Agregar tienda">
        <ion-icon name="add-circle-outline"></ion-icon>
        <span>Agregar</span>
      </button>
    </div>

    <div *ngIf="isLoading" class="loading-stores">
      <div class="skeleton-store" *ngFor="let i of [1,2,3]">
        <div class="skeleton-icon preci-skeleton"></div>
        <div class="skeleton-info">
          <div class="preci-skeleton" style="width: 55%; height: 14px;"></div>
          <div class="preci-skeleton" style="width: 35%; height: 11px; margin-top: 6px;"></div>
        </div>
      </div>
    </div>

    <div *ngIf="stores.length > 0 && !isLoading" class="store-cards">
      <div class="store-card" *ngFor="let store of stores" (click)="goToStore(store)">
        <div class="store-icon-container" [ngClass]="'store-type--' + store.type">
          <ion-icon [name]="getStoreIcon(store.type)"></ion-icon>
        </div>
        <div class="store-info">
          <h4 class="store-name">{{ store.name }}</h4>
          <p class="store-meta">{{ store.district }} &middot; {{ store.type }}</p>
        </div>
        <ion-icon name="chevron-forward-outline" class="store-chevron"></ion-icon>
      </div>
    </div>
  </div>
</ion-content>
