<ion-content>

  <!-- === LOGGED IN === -->
  <ng-container *ngIf="isLoggedIn && user">

    <!-- Perfil header -->
    <div class="profile-header">
      <div class="avatar-container">
        <ion-avatar>
          <img
            [src]="user.avatarUrl || 'https://ionicframework.com/docs/img/demos/avatar.svg'"
            [alt]="user.displayName"
          />
        </ion-avatar>
      </div>
      <h2 class="display-name">{{ user.displayName }}</h2>
      <span class="preci-level preci-level--{{ user.level }}">{{ user.level }}</span>
    </div>

    <!-- Stats cards -->
    <div class="stats-row">
      <div class="stat-card">
        <span class="stat-value preci-price">{{ user.points }}</span>
        <span class="stat-label">Puntos</span>
      </div>
      <div class="stat-card">
        <span class="stat-value preci-price">{{ user.totalReports }}</span>
        <span class="stat-label">Reportes</span>
      </div>
      <div class="stat-card">
        <span class="stat-value">{{ user.level }}</span>
        <span class="stat-label">Nivel</span>
      </div>
    </div>

    <!-- Menu -->
    <div class="menu-section">
      <span class="preci-section-label">Configuracion</span>
      <ion-list lines="full">
        <ion-item lines="full">
          <ion-icon name="color-palette-outline" slot="start" color="primary"></ion-icon>
          <ion-label>Tema</ion-label>
          <div class="theme-segmented" slot="end">
            <button class="theme-seg-btn" [class.active]="theme === 'light'" (click)="setTheme('light')">
              <ion-icon name="sunny-outline"></ion-icon>
            </button>
            <button class="theme-seg-btn" [class.active]="theme === 'system'" (click)="setTheme('system')">
              <ion-icon name="phone-portrait-outline"></ion-icon>
            </button>
            <button class="theme-seg-btn" [class.active]="theme === 'dark'" (click)="setTheme('dark')">
              <ion-icon name="moon-outline"></ion-icon>
            </button>
            <div class="theme-seg-indicator" [style.transform]="segIndicatorTransform"></div>
          </div>
        </ion-item>
        <ion-item button detail>
          <ion-icon name="notifications-outline" slot="start" color="primary"></ion-icon>
          <ion-label>Notificaciones</ion-label>
        </ion-item>
        <ion-item button detail>
          <ion-icon name="trophy-outline" slot="start" style="color: var(--preci-accent)"></ion-icon>
          <ion-label>Mis logros</ion-label>
        </ion-item>
        <ion-item button detail>
          <ion-icon name="location-outline" slot="start" color="medium"></ion-icon>
          <ion-label>Mi distrito</ion-label>
        </ion-item>
        <ion-item button detail>
          <ion-icon name="help-circle-outline" slot="start" color="medium"></ion-icon>
          <ion-label>Ayuda</ion-label>
        </ion-item>
      </ion-list>
    </div>

    <!-- Logout -->
    <div class="logout-section">
      <ion-button expand="block" fill="outline" color="danger" (click)="logout()">
        <ion-icon name="log-out-outline" slot="start"></ion-icon>
        Cerrar sesion
      </ion-button>
    </div>

  </ng-container>

  <!-- === NOT LOGGED IN === -->
  <ng-container *ngIf="!isLoggedIn">

    <!-- Guest header -->
    <div class="profile-header">
      <div class="avatar-container guest">
        <ion-icon name="person-circle-outline" class="guest-icon"></ion-icon>
      </div>
      <h2 class="display-name">Hola, visitante</h2>
      <p class="guest-subtitle">Inicia sesion para ganar puntos y guardar tus listas</p>
    </div>

    <!-- Login CTA -->
    <div class="login-cta-section">
      <ion-button expand="block" color="primary" (click)="login()">
        <ion-icon name="mail-outline" slot="start"></ion-icon>
        Ingresar con correo
      </ion-button>
      <div class="cta-divider">
        <span class="cta-divider-line"></span>
        <span class="cta-divider-text">o</span>
        <span class="cta-divider-line"></span>
      </div>
      <ion-button expand="block" fill="outline" color="medium" (click)="loginWithGoogle()">
        <ion-icon name="logo-google" slot="start"></ion-icon>
        Continuar con Google
      </ion-button>
    </div>

    <!-- Menu con tema (disponible sin cuenta) -->
    <div class="menu-section">
      <span class="preci-section-label">Configuracion</span>
      <ion-list lines="full">
        <ion-item lines="full">
          <ion-icon name="color-palette-outline" slot="start" color="primary"></ion-icon>
          <ion-label>Tema</ion-label>
          <div class="theme-segmented" slot="end">
            <button class="theme-seg-btn" [class.active]="theme === 'light'" (click)="setTheme('light')">
              <ion-icon name="sunny-outline"></ion-icon>
            </button>
            <button class="theme-seg-btn" [class.active]="theme === 'system'" (click)="setTheme('system')">
              <ion-icon name="phone-portrait-outline"></ion-icon>
            </button>
            <button class="theme-seg-btn" [class.active]="theme === 'dark'" (click)="setTheme('dark')">
              <ion-icon name="moon-outline"></ion-icon>
            </button>
            <div class="theme-seg-indicator" [style.transform]="segIndicatorTransform"></div>
          </div>
        </ion-item>
        <ion-item button detail>
          <ion-icon name="help-circle-outline" slot="start" color="medium"></ion-icon>
          <ion-label>Ayuda</ion-label>
        </ion-item>
      </ion-list>
    </div>

  </ng-container>

</ion-content>
