<ion-content>
  <!-- Top safe area + logo + search -->
  <div class="search-top">
    <div class="top-row">
      <img src="assets/preci-logo.png" alt="Preci" class="logo-img" />
      <ion-button fill="clear" size="small" class="notif-btn" aria-label="Notificaciones">
        <ion-icon name="notifications-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </div>

    <div class="search-bar-wrapper">
      <ion-icon name="search-outline" class="search-icon"></ion-icon>
      <input
        type="text"
        [(ngModel)]="searchQuery"
        (input)="onSearch()"
        placeholder="Buscar producto, marca..."
        class="search-input"
        aria-label="Buscar productos por nombre o marca"
      />
      <button
        *ngIf="searchQuery"
        class="search-clear-btn"
        aria-label="Limpiar busqueda"
        (click)="clearSearch()"
      >
        <ion-icon name="close-circle" class="search-clear"></ion-icon>
      </button>
    </div>

    <!-- Category pills — horizontal scroll -->
    <div class="category-pills" *ngIf="!hasSearched">
      <button
        class="pill"
        [class.pill--active]="activeCategory === ''"
        (click)="filterByCategory('')"
      >
        <ion-icon name="grid-outline"></ion-icon>
        <span>Todo</span>
      </button>
      <button
        *ngFor="let cat of categories"
        class="pill"
        [class.pill--active]="activeCategory === cat.key"
        (click)="filterByCategory(cat.key)"
      >
        <ion-icon [name]="cat.icon"></ion-icon>
        <span>{{ cat.label }}</span>
      </button>
    </div>
  </div>

  <!-- ═══ HOME STATE: no search active ═══ -->
  <ng-container *ngIf="!hasSearched">

    <!-- Welcome banner -->
    <div class="welcome-banner">
      <div class="banner-content">
        <p class="banner-title">Compara precios al instante</p>
        <p class="banner-subtitle">Precios reales de supermercados en Lima</p>
      </div>
      <div class="banner-icon">
        <ion-icon name="pricetags-outline"></ion-icon>
      </div>
    </div>

    <!-- Section header -->
    <div class="section-header">
      <h3>{{ activeCategory ? activeCategoryLabel : 'Productos populares' }}</h3>
    </div>

    <!-- Product grid 2 columns -->
    <div class="product-grid-2col">
      <app-product-card
        *ngFor="let product of filteredProducts"
        [product]="product"
        [bestPrice]="getLowestPrice(product)"
        [grid]="true"
        (click)="navigateToProduct(product)"
        class="clickable"
      ></app-product-card>
    </div>

    <!-- Loading skeleton grid -->
    <div *ngIf="popularProducts.length === 0" class="skeleton-grid">
      <div class="skeleton-grid-card" *ngFor="let i of [1,2,3,4,5,6]">
        <div class="skeleton-image preci-skeleton"></div>
        <div class="skeleton-text">
          <div class="preci-skeleton" style="width: 75%; height: 12px;"></div>
          <div class="preci-skeleton" style="width: 50%; height: 10px; margin-top: 6px;"></div>
          <div class="preci-skeleton" style="width: 40%; height: 16px; margin-top: 8px;"></div>
        </div>
      </div>
    </div>
  </ng-container>

  <!-- ═══ SEARCH RESULTS ═══ -->
  <div *ngIf="hasSearched && results.length > 0" class="results-section">
    <app-product-card
      *ngFor="let product of results"
      [product]="product"
      [bestPrice]="getLowestPrice(product)"
      (click)="navigateToProduct(product)"
      class="clickable"
    ></app-product-card>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="ion-padding ion-text-center">
    <ion-spinner name="crescent" color="primary"></ion-spinner>
  </div>

  <!-- Empty state -->
  <app-empty-state
    *ngIf="hasSearched && results.length === 0 && !isLoading"
    preset="search"
  ></app-empty-state>
</ion-content>
