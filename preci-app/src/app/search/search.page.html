<ion-content>
  <!-- Top safe area + logo + search -->
  <div class="search-top">
    <div class="top-row">
      <img src="assets/preci-logo.png" alt="Preci" class="logo-img" />
      <ion-button fill="clear" size="small" class="notif-btn" aria-label="Notificaciones">
        <ion-icon name="notifications-outline" slot="icon-only"></ion-icon>
      </ion-button>
    </div>

    <div class="search-bar-wrapper">
      <ion-icon name="search-outline" class="search-icon"></ion-icon>
      <input
        type="text"
        [(ngModel)]="searchQuery"
        (input)="onSearch()"
        placeholder="Buscar producto, marca..."
        class="search-input"
        aria-label="Buscar productos por nombre o marca"
      />
      <button
        *ngIf="searchQuery"
        class="search-clear-btn"
        aria-label="Limpiar busqueda"
        (click)="searchQuery = ''; onSearch()"
      >
        <ion-icon name="close-circle" class="search-clear"></ion-icon>
      </button>
    </div>
  </div>

  <!-- Productos populares cuando no hay busqueda -->
  <div *ngIf="!hasSearched" class="basket-section">
    <div class="section-header">
      <h3>Productos populares</h3>
      <p class="subtitle">Precios reales de supermercados</p>
    </div>

    <div class="product-grid">
      <app-product-card
        *ngFor="let product of popularProducts"
        [product]="product"
        [bestPrice]="getLowestPrice(product)"
        [compact]="true"
        (click)="navigateToProduct(product)"
        class="clickable"
      ></app-product-card>
    </div>

    <!-- Loading skeleton -->
    <div *ngIf="popularProducts.length === 0" class="skeleton-list">
      <div class="skeleton-card" *ngFor="let i of [1,2,3,4,5,6]">
        <div class="skeleton-image preci-skeleton"></div>
        <div class="skeleton-text">
          <div class="preci-skeleton" style="width: 60%; height: 14px;"></div>
          <div class="preci-skeleton" style="width: 40%; height: 12px; margin-top: 6px;"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- Resultados de busqueda -->
  <div *ngIf="hasSearched && results.length > 0" class="results-section">
    <app-product-card
      *ngFor="let product of results"
      [product]="product"
      [bestPrice]="getLowestPrice(product)"
      (click)="navigateToProduct(product)"
      class="clickable"
    ></app-product-card>
  </div>

  <!-- Loading -->
  <div *ngIf="isLoading" class="ion-padding ion-text-center">
    <ion-spinner name="crescent" color="primary"></ion-spinner>
  </div>

  <!-- Empty state -->
  <app-empty-state
    *ngIf="hasSearched && results.length === 0 && !isLoading"
    preset="search"
  ></app-empty-state>
</ion-content>
